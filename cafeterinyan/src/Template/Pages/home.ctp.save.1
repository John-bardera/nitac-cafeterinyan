<?php
use Cake\Cache\Cache;
use Cake\Core\Configure;
use Cake\Core\Plugin;
use Cake\Datasource\ConnectionManager;
use Cake\Error\Debugger;
use Cake\Http\Exception\NotFoundException;

$this->layout = false;
echo $this->Html->css('home');

if (!Configure::read('debug')):
    throw new NotFoundException(
        'Please replace src/Template/Pages/home.ctp with your own version or re-enable debug mode.'
    );
endif;

$cakeDescription = 'CakePHP: the rapid development PHP framework';
?>
<!DOCTYPE html>

<html>
<head>
    <?= $this->Html->charset() ?>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <?= $cakeDescription ?>
    </title>

    <?= $this->Html->meta('icon') ?>
    <?= $this->Html->css('base.css') ?>
    <?= $this->Html->css('style.css') ?>
    <?= $this->Html->css('home.css') ?>
    <link href="https://fonts.googleapis.com/css?family=Raleway:500i|Roboto:300,400,700|Roboto+Mono" rel="stylesheet">
</head>
<body class="home">

<header class="row">
</header>
<?php

$conn = "host=localhost port=5432 dbname=team5db user=team5 password=hogenyan";
$link = pg_connect($conn);
if (!$link) {
    die('接続失敗です。'.pg_last_error());
}

print('接続に成功しました。<br>');

$result = pg_query_params($link, 'SELECT image FROM menu_info WHERE id = $1', array("-1"));
$arr = pg_fetch_array($result);
?>
<div><?php echo $arr[0]; ?></div>
<div class="todayAB">
    <div class="todayA">
        <div class="todayA_txt">今日のAメニュー</div>
        <?php
            $ta = pg_query_params($link, 'SELECT name, image, likes FROM daily_menu LEFT OUTER JOIN menu_info ON daily_menu.id = menu_info.id WHERE date = $1 AND type = 0 ', array(date("Y-m-d")));
            $taarr = pg_fetch_array($ta);
        ?>
        <div class="todayA_name"><?php echo $taarr[0] ?></div>
        <img src="<?php echo $taarr[1] ?>" class="todayA_img">
        <div class="iine"><?php echo $taarr[2] ?></div>
	<div class="todayA_so">売り切れ</div>
    </div>
    <div class="todayB">
        <div class="todayB_txt">今日のBメニュー</div>
        <?php
            $tb = pg_query_params($link, 'SELECT name, image, likes FROM daily_menu LEFT OUTER JOIN menu_info ON daily_menu.id = menu_info.id WHERE date = $1 AND type = 1 ', array(date("Y-m-d")));
            $tbbrr = pg_fetch_array($tb);
        ?>
        <div class="todayB_name"><?php echo $tbbrr[0] ?></div>
        <img src="<?php echo $tbbrr[1] ?>" class="todayB_img">
        <div class="iine"><?php echo $tbbrr[2] ?></div>
        <div class="todayB_so">売り切れ</div>
    </div>
</div>
<div class="josetsu">
    常設メニュー

        <?php 
            $js = pg_querry_params($link, 'SELECT name, image, likes, id FROM daily_menu LEFT OUTER JOIN menu_info ON daily_menu.id = menu_info.id WHERE type = 2 ', );
            $jo = pg_fetch_array($js);
        ?>
        <div class="josetsu_name"><?php echo $jo[0] ?></div>
        <img src="<?php echo $jo[1] ?>" class="josetsu_img">
        <div class="iine"><?php echo $jo[2] ?></div>
        <div class="josetsu_so">売り切れ</div>
    <?php } ?>
</div>
<div class="weeklyAB">
    今週のメニュー
    <div class="weeklyA">
        <?php for($i = 1; $i <= 10; $i++) { ?>
            <img src="<?php ?>" class="weeklyA_img">
            <div class="iine"></div>
            <div class="weeklyA_so"></div>
        <?php } ?>
    </div>
    <div class="weeklyB">
        <?php for($i = 1; $i <= 10; $i++) { ?>
            <img src="<?php ?>" class="weeklyB_img">
            <div class="iine"></div>
            <div class="weeklyB_so"></div>
        <?php } ?>
    </div>
</div>
</body>
</html>

<?php
// PostgreSQLに対する処理
$close_flag = pg_close($link);

if ($close_flag){
    print('切断に成功しました。<br>');
}
?>

